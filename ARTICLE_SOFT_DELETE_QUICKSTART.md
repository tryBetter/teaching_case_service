# 文章软删除功能快速开始

## 🎯 核心功能

文章删除现已升级为**软删除**机制，提供更安全的数据管理方式。

## 📋 主要特性

- ✅ **软删除**：删除的文章可以恢复
- ✅ **回收站**：查看所有已删除的文章
- ✅ **一键恢复**：快速恢复误删的文章
- ✅ **永久删除**：彻底删除无关联数据的文章
- ✅ **智能保护**：有关联数据的文章无法永久删除

## 🚀 API 端点

### 1. 软删除文章（可恢复）
```http
DELETE /api/admin/articles/:id
```

### 2. 恢复已删除文章
```http
POST /api/admin/articles/:id/restore
```

### 3. 查看回收站（已删除文章列表）
```http
GET /api/admin/articles/deleted/list?page=1&limit=10
```

### 4. 永久删除（谨慎使用）
```http
DELETE /api/admin/articles/:id/permanent
```

### 5. 统计信息（包含已删除数量）
```http
GET /api/admin/articles/stats/overview
```

## 💡 使用场景

### 场景 1：误删文章
1. 用户不小心删除了一篇重要文章
2. 进入回收站查找该文章
3. 点击"恢复"按钮
4. 文章恢复正常，所有关联数据（评论、收藏、笔记）保持不变

### 场景 2：定期清理
1. 查看回收站中的已删除文章
2. 确认某些文章不再需要
3. 尝试永久删除
4. 系统提示：该文章有评论/收藏/笔记，无法删除
5. 决定保留或先清理关联数据

### 场景 3：数据审计
1. 通过统计接口查看已删除文章数量
2. 定期检查回收站，了解删除趋势
3. 必要时恢复误删的内容

## ⚠️ 注意事项

### 软删除行为
- 删除的文章不会在前端显示
- 文章的所有关联数据（评论、收藏、笔记）仍然存在
- 可以随时恢复

### 永久删除限制
永久删除会检查以下关联数据：
- ❌ 有评论 → 无法删除
- ❌ 有收藏 → 无法删除
- ❌ 有笔记 → 无法删除
- ✅ 无任何关联 → 可以删除

### 数据统计
- `totalArticles`：不包含已删除文章
- `deletedArticles`：已删除文章总数（新增）
- 所有其他统计都排除已删除文章

## 🔧 技术细节

### 数据库字段
```typescript
deletedAt: DateTime? // null = 未删除，有值 = 已删除
```

### 查询过滤
所有查询都自动添加：
```typescript
where: { deletedAt: null }
```

### 软删除实现
```typescript
// 软删除
await prisma.article.update({
  where: { id },
  data: { deletedAt: new Date() }
});

// 恢复
await prisma.article.update({
  where: { id },
  data: { deletedAt: null }
});
```

## 📊 前端建议

### 1. 文章列表页面
- 添加"回收站"标签页
- 显示已删除文章数量徽章
- 提供"恢复"和"永久删除"按钮

### 2. 删除确认对话框
```
⚠️ 确认删除文章？

文章将被移至回收站，可以在回收站中恢复。

[取消] [删除]
```

### 3. 回收站页面
```
📁 回收站 (30)

文章列表：
- 文章标题
- 删除时间
- 作者
- [恢复] [永久删除]
```

### 4. 永久删除确认
```
⚠️ 永久删除警告

此操作不可恢复！确定要永久删除这篇文章吗？

注意：如果文章有评论、收藏或笔记，将无法删除。

[取消] [永久删除]
```

## 🎨 状态指示

建议在UI中使用不同颜色标识文章状态：
- 🟢 已发布：绿色
- 🟡 草稿：黄色
- 🔴 已删除：红色（仅在回收站显示）
- ⭐ 推荐：星标

## 📝 完整文档

详细实现和技术细节请参考：
- [ARTICLE_SOFT_DELETE_README.md](./ARTICLE_SOFT_DELETE_README.md)

## 🆘 常见问题

**Q: 为什么不能永久删除文章？**  
A: 文章有关联数据（评论/收藏/笔记）。请先清理关联数据，或使用软删除保留数据。

**Q: 软删除的文章占用存储空间吗？**  
A: 是的。建议定期清理回收站，或实现自动清理机制（如90天后自动永久删除）。

**Q: 恢复文章后，评论等数据会恢复吗？**  
A: 会！软删除不影响关联数据，恢复后一切如初。

**Q: 可以批量删除/恢复吗？**  
A: 当前版本不支持，这是未来的改进方向。

---

**实现日期**：2025年10月8日  
**版本**：v1.0

