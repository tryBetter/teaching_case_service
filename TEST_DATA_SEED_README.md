# 测试数据生成脚本使用说明

## 概述

本脚本用于生成覆盖所有模块和接口的测试数据，包括用户、文章、评论、收藏、笔记、热搜等完整的数据结构。

## 使用方法

### 1. 运行基础数据初始化（首次使用）

```bash
npm run seed
```

这个命令会创建：
- 角色和权限
- 分类
- 筛选条件
- 超级管理员账号

### 2. 生成测试数据

```bash
npm run seed:test-data
```

这个命令会创建完整的测试数据。

## 生成的测试数据

### 用户数据
- **超级管理员**: superadmin@test.com (TestSuperAdmin123!)
- **管理员**: admin@test.com (TestAdmin123!)
- **教师组长**: teacher-leader@test.com, teacher-leader2@test.com (TestTeacher123!)
- **教师**: teacher1@test.com, teacher2@test.com, teacher3@test.com (TestTeacher123!)
- **助教组长**: assistant-leader@test.com (TestAssistant123!)
- **助教**: assistant1@test.com, assistant2@test.com, assistant3@test.com (TestAssistant123!)
- **学生**: student1@test.com 到 student5@test.com (TestStudent123!)

### 文章数据
生成5篇测试文章，涵盖：
- 液体火箭发动机燃烧室设计原理
- 固体火箭发动机推进剂配方优化
- 超燃冲压发动机燃烧不稳定性研究
- 燃气涡轮发动机叶片冷却技术
- 组合发动机系统集成技术

每篇文章包含：
- 完整的标题、内容、摘要
- 关键词标签
- 分类关联
- 筛选条件关联
- 媒体文件关联
- 发布状态设置

### 评论数据
- 多层级评论（包含回复）
- 不同角色的用户评论
- 评论点赞数据

### 收藏和笔记
- 用户收藏文章
- 用户学习笔记

### 热搜数据
10个热门搜索关键词，包含点击量和排序

### 教师-助教关联
创建教师与助教的关联关系

### 媒体文件
8个测试媒体文件（图片和视频）

## 数据特点

1. **完整性**: 覆盖所有数据模型和关联关系
2. **真实性**: 使用真实的教学案例内容
3. **多样性**: 包含不同角色、不同状态的数据
4. **关联性**: 数据之间具有合理的关联关系
5. **可扩展性**: 支持重复运行，自动跳过已存在的数据

## 注意事项

1. **依赖关系**: 必须先运行基础seed脚本创建角色和权限
2. **数据安全**: 脚本会自动检查现有数据，避免重复创建
3. **错误处理**: 包含完整的错误处理和日志输出
4. **密码安全**: 所有测试用户密码都经过bcrypt加密

## 清理数据

如需清理测试数据，可以手动删除数据库中的数据，或者重新初始化数据库：

```bash
# 重置数据库
npx prisma migrate reset

# 重新运行seed脚本
npm run seed
npm run seed:test-data
```

## 自定义配置

可以通过修改 `src/seed/test-data.seed.ts` 文件来自定义：
- 用户数量
- 文章内容
- 评论内容
- 热搜关键词
- 媒体文件路径

## 故障排除

1. **权限错误**: 确保数据库连接正常，用户有足够的权限
2. **外键约束**: 确保基础数据（角色、分类等）已正确创建
3. **重复数据**: 脚本会自动处理重复数据，无需担心
4. **内存不足**: 如果数据量过大，可以分批生成

## 开发建议

1. 在开发环境中使用此脚本快速搭建测试环境
2. 可以根据实际需要调整数据量和内容
3. 建议在CI/CD流程中集成此脚本进行自动化测试
4. 定期更新测试数据以保持内容的时效性
