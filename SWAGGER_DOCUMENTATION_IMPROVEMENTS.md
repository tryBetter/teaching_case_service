# Swagger API 文档改进总结

本文档记录了教学案例服务后台管理系统的 Swagger API 文档改进内容。

## 📋 改进概览

已对所有主要模块的 API 接口进行了详细的文档化，包括接口描述、参数说明、返回值说明、错误处理和使用场景。

## ✅ 已改进的模块

### 1. 用户管理模块 (`/users`)

#### 主要接口

**POST /users** - 创建用户
- ✨ 添加详细的业务场景说明
- ✨ 明确权限要求：仅管理员和超级管理员
- ✨ 说明不能创建超级管理员角色
- ✨ 完善返回值结构说明

**GET /users** - 获取用户列表（分页）
- ✨ 详细说明分页参数（page, limit）
- ✨ 说明角色筛选参数的可选值
- ✨ 说明搜索功能（支持姓名和邮箱模糊匹配）
- ✨ 添加使用场景：后台管理、教师查看助教、组长查看成员

**GET /users/template** - 下载导入模板
- ✨ 说明模板文件格式和内容
- ✨ 明确权限限制和适用场景
- ✨ 处理中文文件名编码问题（RFC 5987）

**POST /users/batch** - 批量导入用户
- ✨ 详细说明Excel文件格式要求
- ✨ 说明成功/失败结果的返回格式
- ✨ 列举可能的错误原因
- ✨ 明确不支持导入超级管理员

**GET /users/roles** - 获取角色下拉选项
- ✨ 说明返回的角色列表不包含超级管理员
- ✨ 说明安全考虑和设计原因
- ✨ 适用场景：创建/编辑用户的角色选择器

**PATCH /users/:id** - 更新用户信息
- ✨ 说明密码字段为可选（不提供时保持原密码）
- ✨ 明确不能改为超级管理员角色
- ✨ 添加适用场景说明

**DELETE /users/:id** - 删除用户
- ✨ 说明这是硬删除操作
- ✨ 建议优先使用禁用功能
- ✨ 警告删除可能的数据完整性问题

**PATCH /users/:id/disable** - 禁用用户
- ✨ 说明软删除机制
- ✨ 说明这是可逆操作
- ✨ 添加典型使用场景

**PATCH /users/:id/enable** - 启用用户
- ✨ 说明恢复访问权限的过程
- ✨ 添加使用场景

---

### 2. 文章管理模块 (`/articles`)

#### 主要接口

**POST /articles** - 创建文章
- ✨ 说明自动设置当前用户为作者
- ✨ 说明草稿和发布状态
- ✨ 说明可关联的元数据（分类、筛选条件、关键词）
- ✨ 权限说明：教师和教师组长专用

**GET /articles** - 获取文章列表（分页+筛选）
- ✨ 详细说明多维度筛选功能
  - published: 发布状态筛选
  - categoryId: 按分类筛选
  - authorId: 按作者筛选
  - search: 关键词搜索
  - includeDeleted: 包含已删除文章
- ✨ 说明超级管理员专用
- ✨ 适用场景：后台管理、内容审核、统计分析

**GET /articles/all** - 获取所有文章（无分页）
- ✨ 明确这是公开接口
- ✨ 说明仅返回已发布文章
- ✨ 适用场景：前端展示、数据导出

**GET /articles/deleted/list** - 获取回收站文章列表
- ✨ 说明软删除机制
- ✨ 说明可恢复或永久删除
- ✨ 适用场景：回收站功能、误删除恢复

**GET /articles/stats** - 获取文章统计数据
- ✨ 说明统计维度
- ✨ 适用场景：仪表盘、报表、数据分析

**POST /articles/:id/restore** - 恢复已删除文章
- ✨ 说明从回收站恢复
- ✨ 权限要求

**DELETE /articles/:id/permanent** - 永久删除文章
- ✨ 警告不可逆操作
- ✨ 说明删除条件和限制

**POST /articles/:id/publish** - 发布文章
- ✨ 说明从草稿变为已发布
- ✨ 权限要求

---

### 3. 分类管理模块 (`/categories`)

#### 主要接口

**POST /categories** - 创建分类
- ✨ 说明分类用途和重要性
- ✨ 明确名称唯一性要求
- ✨ 权限：管理员和教师
- ✨ 适用场景：新增内容类型、优化组织结构

**GET /categories** - 获取所有分类列表
- ✨ 明确这是公开接口
- ✨ 说明返回文章数量统计
- ✨ 适用场景：导航菜单、筛选器、管理页面

**GET /categories/:id** - 获取分类详情
- ✨ 说明返回该分类下的文章列表
- ✨ 仅返回已发布文章
- ✨ 适用场景：分类页面、内容导航

**PATCH /categories/:id** - 更新分类
- ✨ 权限说明
- ✨ 名称冲突处理

**DELETE /categories/:id** - 删除分类
- ✨ 说明删除限制（分类下有文章时无法删除）
- ✨ 建议先迁移文章再删除
- ✨ 权限：仅管理员

---

### 4. 媒体管理模块 (`/media`)

#### 主要接口

**POST /media/upload** - 上传媒体文件
- ✨ 详细说明支持的文件格式
- ✨ 明确大小限制（图片50MB，视频1GB）
- ✨ 说明自动分类存储机制
- ✨ 说明可关联到文章
- ✨ 添加上传者追溯说明
- ✨ 权限：教师和教师组长

**GET /media** - 获取媒体文件列表
- ✨ 说明分页和筛选功能
- ✨ 说明超级管理员可查看所有文件
- ✨ 说明返回的信息（URL、类型、大小、上传者、关联文章）
- ✨ 适用场景：后台管理、存储统计

**GET /media/stats/overview** - 获取媒体统计信息
- ✨ 超级管理员专用
- ✨ 统计存储使用情况

**GET /media/:id** - 获取媒体文件详情
- ✨ 返回完整信息
- ✨ 包含关联文章列表

**DELETE /media/:id** - 删除媒体文件
- ✨ 权限要求
- ✨ 删除影响说明

---

### 5. 评论管理模块 (`/comment`)

#### 主要接口

**POST /comment** - 创建评论/回复
- ✨ 说明支持顶级评论和楼中楼回复
- ✨ 说明parentId参数的用途
- ✨ 适用场景：学生发表看法、教师交流、助教答疑
- ✨ 说明自动关联作者

**GET /comment** - 获取评论列表（分页+筛选）
- ✨ 说明筛选条件（articleId, authorId）
- ✨ 说明返回点赞数量和点赞状态
- ✨ 说明包含回复列表
- ✨ 适用场景：后台管理、文章详情页、用户评论历史

---

## 🎯 改进重点

### 1. 业务场景描述
为每个接口添加了实际使用场景，帮助开发者理解接口的用途：
- ✅ 后台管理系统的使用场景
- ✅ 教师/学生/助教的使用场景
- ✅ 数据管理和维护场景

### 2. 权限说明清晰化
明确每个接口的权限要求和限制：
- ✅ 超级管理员专用接口
- ✅ 管理员和超级管理员接口
- ✅ 教师和教师组长接口
- ✅ 所有已登录用户接口
- ✅ 公开接口（无需认证）

### 3. 参数说明详细化
为每个参数添加了：
- ✅ 参数含义和用途
- ✅ 参数格式和范围
- ✅ 可选值列表
- ✅ 默认值说明
- ✅ 使用示例

### 4. 返回值结构说明
详细描述返回数据的结构：
- ✅ 分页数据结构 `{data: [], pagination: {}}`
- ✅ 每个字段的含义
- ✅ 关联数据说明
- ✅ 特殊字段说明（如deletedAt、likeCount等）

### 5. 错误处理说明
为常见错误添加详细说明：
- ✅ 400: 参数错误的具体原因
- ✅ 401: 未授权访问
- ✅ 403: 权限不足的角色要求
- ✅ 404: 资源不存在
- ✅ 409: 冲突（如重复创建）
- ✅ 500: 服务器错误

### 6. 特殊说明
添加了重要的注意事项：
- ✅ 超级管理员创建限制
- ✅ 软删除 vs 硬删除
- ✅ 可逆操作说明
- ✅ 数据完整性警告
- ✅ 文件大小和格式限制

---

## 📚 Swagger 文档访问

启动服务后，可以通过以下地址访问 Swagger API 文档：

```
http://localhost:3000/api
```

### 主要功能：
- 📖 查看所有 API 接口
- 🔍 搜索特定接口
- 🧪 在线测试接口（Try it out）
- 📝 查看请求/响应示例
- 🔐 配置 Bearer Token 认证

---

## 🎯 改进的核心模块

| 模块     | 接口数量 | 改进内容         |
| -------- | -------- | ---------------- |
| 用户管理 | 11个     | ✅ 完整文档化     |
| 文章管理 | 15个     | ✅ 核心接口文档化 |
| 分类管理 | 5个      | ✅ 完整文档化     |
| 媒体管理 | 8个      | ✅ 核心接口文档化 |
| 评论管理 | 10个     | ✅ 核心接口文档化 |
| 笔记管理 | 8个      | 现有文档较完善   |
| 收藏管理 | 6个      | 现有文档较完善   |
| 角色权限 | 10个     | 现有文档较完善   |
| 认证模块 | 4个      | 现有文档较完善   |
| 后台管理 | 5个      | 现有文档较完善   |

---

## 💡 使用建议

### 1. 接口测试
在 Swagger UI 中测试接口前：
1. 点击右上角"Authorize"按钮
2. 输入 Bearer Token（格式：`Bearer your_token_here`）
3. 点击接口下方的"Try it out"按钮
4. 填写参数后点击"Execute"

### 2. 获取 Token
使用登录接口获取 Token：
```bash
POST /auth/login
{
  "email": "superadmin@test.com",
  "password": "TestSuperAdmin123!"
}
```

返回的 `access_token` 即为所需的 Token。

### 3. 权限说明
接口按权限分为几类：
- 🔓 **公开接口** - 无需认证，任何人可访问
- 🔐 **已登录用户** - 需要 JWT Token
- 👨‍🏫 **教师专用** - 教师、教师组长可访问
- 👨‍💼 **管理员专用** - 管理员、超级管理员可访问
- 🛡️ **超级管理员专用** - 仅超级管理员可访问

---

## 📊 接口分类

### 🔓 公开接口（无需认证）
- GET /categories - 获取分类列表
- GET /categories/:id - 获取分类详情
- GET /articles/all - 获取所有文章
- GET /articles/:id - 获取文章详情
- GET /articles/many - 条件查询文章
- POST /auth/login - 用户登录
- POST /auth/register - 用户注册

### 🔐 已登录用户接口
- POST /comment - 创建评论
- POST /note - 创建笔记
- POST /favorite - 收藏文章
- GET /note - 获取我的笔记
- GET /favorite - 获取我的收藏

### 👨‍🏫 教师专用接口
- POST /articles - 创建文章
- POST /media/upload - 上传媒体文件
- POST /categories - 创建分类

### 👨‍💼 管理员专用接口
- POST /users - 创建用户
- PATCH /users/:id - 更新用户
- DELETE /users/:id - 删除用户
- PATCH /users/:id/disable - 禁用用户
- PATCH /users/:id/enable - 启用用户
- GET /users/template - 下载导入模板
- POST /users/batch - 批量导入用户

### 🛡️ 超级管理员专用接口
- GET /users/roles - 获取角色列表
- GET /users/stats - 用户统计
- GET /articles?* - 文章列表（含回收站）
- GET /articles/deleted/list - 回收站列表
- POST /articles/:id/restore - 恢复文章
- DELETE /articles/:id/permanent - 永久删除文章
- GET /media/stats/overview - 媒体统计
- GET /admin/overview - 后台概览
- GET /admin/stats/* - 各类统计接口

---

## 🚀 下一步

1. **启动服务**
   ```bash
   npm run start:dev
   ```

2. **访问 Swagger 文档**
   ```
   http://localhost:3000/api
   ```

3. **测试接口**
   - 使用 Swagger UI 的 Try it out 功能
   - 查看详细的请求/响应示例
   - 了解接口的业务场景和使用方法

---

## 📝 文档维护

后续添加新接口时，请遵循以下规范：

### 接口描述格式
```typescript
@ApiOperation({
  summary: '简短的接口标题',
  description: '【权限说明】详细的业务场景描述。适用场景：xxx、xxx。注意事项：xxx。'
})
```

### 参数描述格式
```typescript
@ApiQuery({
  name: '参数名',
  description: '参数含义和用途。可选值/范围说明。示例说明',
  required: false,
  type: Number,
  example: 1,
})
```

### 响应描述格式
```typescript
@ApiResponse({
  status: 200,
  description: '成功情况的详细说明，包括返回的数据结构',
  schema: { /* 详细的数据结构定义 */ }
})
```

---

## ✅ 改进成果

- ✅ 所有主要接口添加了详细的业务场景说明
- ✅ 权限要求清晰明确
- ✅ 参数说明详细，包含示例
- ✅ 返回值结构完整
- ✅ 错误处理文档化
- ✅ 使用建议和注意事项完善
- ✅ 支持 Swagger UI 在线测试

---

*文档生成时间：2025-10-11*
*版本：v1.0*

