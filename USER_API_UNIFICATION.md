# ç”¨æˆ·æ¨¡å—æ¥å£ç»Ÿä¸€è¯´æ˜

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

ç»Ÿä¸€äº† `/users` å’Œ `/admin/users` ä¸¤å¥—ç”¨æˆ·æ¥å£çš„è¡Œä¸ºå’Œè¿”å›æ ¼å¼ï¼Œæä¾›ä¸€è‡´çš„APIä½“éªŒã€‚

**æ›´æ–°æ—¥æœŸ**ï¼š2025å¹´10æœˆ8æ—¥

## ğŸ”„ ä¸»è¦æ”¹åŠ¨

### 1. ç”¨æˆ·åˆ—è¡¨æ¥å£ç»Ÿä¸€

#### ä¹‹å‰çš„è¡Œä¸º

**`/users` æ¥å£ï¼š**
```javascript
// è¯·æ±‚
GET /users

// è¿”å›ï¼ˆæ— åˆ†é¡µï¼‰
[
  { id: 1, email: "user1@test.com", name: "ç”¨æˆ·1", role: {...} },
  { id: 2, email: "user2@test.com", name: "ç”¨æˆ·2", role: {...} },
  ...æ‰€æœ‰ç”¨æˆ·
]
```

**`/admin/users` æ¥å£ï¼š**
```javascript
// è¯·æ±‚
GET /admin/users?page=1&limit=10

// è¿”å›ï¼ˆæœ‰åˆ†é¡µï¼‰
{
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 150,
    "totalPages": 15
  }
}
```

#### ç°åœ¨çš„è¡Œä¸ºï¼ˆç»Ÿä¸€åï¼‰

**`/users` æ¥å£ç°åœ¨æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š**

**æ¨¡å¼ 1ï¼šä¸å¸¦åˆ†é¡µå‚æ•°ï¼ˆå‘åå…¼å®¹ï¼‰**
```javascript
// è¯·æ±‚
GET /users

// è¿”å›æ‰€æœ‰ç”¨æˆ·ï¼ˆä¿æŒå…¼å®¹ï¼‰
[
  { id: 1, email: "user1@test.com", ... },
  { id: 2, email: "user2@test.com", ... },
  ...
]
```

**æ¨¡å¼ 2ï¼šå¸¦åˆ†é¡µå‚æ•°ï¼ˆä¸adminç»Ÿä¸€ï¼‰**
```javascript
// è¯·æ±‚
GET /users?page=1&limit=10&search=å¼ ä¸‰&role=æ•™å¸ˆ

// è¿”å›åˆ†é¡µæ ¼å¼ï¼ˆä¸adminä¸€è‡´ï¼‰
{
  "data": [
    {
      "id": 1,
      "email": "user@test.com",
      "name": "å¼ ä¸‰",
      "role": {
        "id": 4,
        "name": "æ•™å¸ˆ",
        "description": "æ•™å¸ˆè§’è‰²"
      },
      "_count": {
        "articles": 5,
        "comments": 12,
        "notes": 8,
        "favorites": 15
      }
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 150,
    "totalPages": 15
  }
}
```

### 2. æŸ¥è¯¢å‚æ•°æ”¯æŒ

#### æ–°å¢æŸ¥è¯¢å‚æ•°

| å‚æ•°   | ç±»å‹   | å¿…å¡« | è¯´æ˜                     | ç¤ºä¾‹   |
| ------ | ------ | ---- | ------------------------ | ------ |
| page   | number | å¦   | é¡µç                      | 1      |
| limit  | number | å¦   | æ¯é¡µæ•°é‡                 | 10     |
| role   | string | å¦   | è§’è‰²ç­›é€‰                 | "æ•™å¸ˆ" |
| search | string | å¦   | æœç´¢å…³é”®è¯ï¼ˆå§“åæˆ–é‚®ç®±ï¼‰ | "å¼ ä¸‰" |

### 3. è¿”å›æ•°æ®å¢å¼º

#### ä¹‹å‰
```javascript
{
  "id": 1,
  "email": "user@test.com",
  "name": "å¼ ä¸‰",
  "role": { "id": 4, "name": "æ•™å¸ˆ" }
}
```

#### ç°åœ¨
```javascript
{
  "id": 1,
  "email": "user@test.com",
  "name": "å¼ ä¸‰",
  "role": {
    "id": 4,
    "name": "æ•™å¸ˆ",
    "description": "æ•™å¸ˆè§’è‰²"  // æ–°å¢
  },
  "_count": {  // æ–°å¢ç»Ÿè®¡ä¿¡æ¯
    "articles": 5,
    "comments": 12,
    "notes": 8,
    "favorites": 15
  }
}
```

### 4. æ“ä½œæ¥å£ç»Ÿä¸€

#### æ›´æ–°ç”¨æˆ·æ¥å£å¢å¼º

**ä¹‹å‰ï¼š**
```javascript
PATCH /users/:id
// è¿”å›ï¼šåŸºæœ¬ç”¨æˆ·ä¿¡æ¯
```

**ç°åœ¨ï¼š**
```javascript
PATCH /users/:id
// è¿”å›ï¼šåŒ…å«å®Œæ•´è§’è‰²ä¿¡æ¯çš„ç”¨æˆ·æ•°æ®
// æ”¯æŒå¯†ç è‡ªåŠ¨åŠ å¯†
```

#### åˆ é™¤ç”¨æˆ·æ¥å£å¢å¼º

**ä¹‹å‰ï¼š**
```javascript
DELETE /users/:id
// è¿”å›ï¼šPrismaåˆ é™¤ç»“æœ
```

**ç°åœ¨ï¼š**
```javascript
DELETE /users/:id
// è¿”å›ï¼š
{
  "id": 1,
  "email": "user@test.com",
  "name": "å¼ ä¸‰",
  "message": "ç”¨æˆ·åˆ é™¤æˆåŠŸ"
}
```

#### æ–°å¢æ¥å£

**`/users/:id/disable` - ç¦ç”¨ç”¨æˆ·**
```javascript
PATCH /users/:id/disable

// è¿”å›ï¼š
{
  "id": 1,
  "email": "user@test.com",
  "name": "å¼ ä¸‰",
  "status": "INACTIVE",
  "message": "ç”¨æˆ·å·²ç¦ç”¨"
}
```

**`/users/:id/enable` - å¯ç”¨ç”¨æˆ·**
```javascript
PATCH /users/:id/enable

// è¿”å›ï¼š
{
  "id": 1,
  "email": "user@test.com",
  "name": "å¼ ä¸‰",
  "status": "ACTIVE",
  "message": "ç”¨æˆ·å·²å¯ç”¨"
}
```

## ğŸ“Š æ¥å£å¯¹æ¯”è¡¨

### åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½     | `/users` (ä¹‹å‰) | `/users` (ç°åœ¨) | `/admin/users` |
| -------- | --------------- | --------------- | -------------- |
| è·å–åˆ—è¡¨ | âœ… æ— åˆ†é¡µ        | âœ… æ”¯æŒåˆ†é¡µ      | âœ… æ”¯æŒåˆ†é¡µ     |
| æœç´¢ç­›é€‰ | âŒ               | âœ…               | âœ…              |
| è§’è‰²ç­›é€‰ | âŒ               | âœ…               | âœ…              |
| ç»Ÿè®¡ä¿¡æ¯ | âŒ               | âœ…               | âœ…              |
| ç¦ç”¨ç”¨æˆ· | âŒ               | âœ…               | âœ…              |
| å¯ç”¨ç”¨æˆ· | âŒ               | âœ…               | âœ…              |
| æ‰¹é‡å¯¼å…¥ | âœ…               | âœ…               | âœ…              |
| ä¸‹è½½æ¨¡æ¿ | âœ…               | âœ…               | âœ…              |

### æƒé™å¯¹æ¯”

| æ¥å£           | æƒé™è¦æ±‚   | é€‚ç”¨åœºæ™¯     |
| -------------- | ---------- | ------------ |
| `/users`       | æ•™å¸ˆæˆ–åŠ©æ•™ | æ—¥å¸¸ç”¨æˆ·ç®¡ç† |
| `/admin/users` | è¶…çº§ç®¡ç†å‘˜ | ç³»ç»Ÿçº§ç®¡ç†   |

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šè·å–æ‰€æœ‰ç”¨æˆ·ï¼ˆå‘åå…¼å®¹ï¼‰

```bash
GET /users
```

**è¿”å›ï¼š**
```json
[
  { "id": 1, "email": "user1@test.com", ... },
  { "id": 2, "email": "user2@test.com", ... }
]
```

### ç¤ºä¾‹ 2ï¼šåˆ†é¡µè·å–ç”¨æˆ·ï¼ˆæ–°åŠŸèƒ½ï¼‰

```bash
GET /users?page=1&limit=10
```

**è¿”å›ï¼š**
```json
{
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 150,
    "totalPages": 15
  }
}
```

### ç¤ºä¾‹ 3ï¼šæœç´¢ç”¨æˆ·ï¼ˆæ–°åŠŸèƒ½ï¼‰

```bash
GET /users?page=1&limit=10&search=å¼ ä¸‰
```

**è¿”å›ï¼š**åŒ¹é…"å¼ ä¸‰"çš„ç”¨æˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µæ ¼å¼ï¼‰

### ç¤ºä¾‹ 4ï¼šæŒ‰è§’è‰²ç­›é€‰ï¼ˆæ–°åŠŸèƒ½ï¼‰

```bash
GET /users?page=1&limit=10&role=æ•™å¸ˆ
```

**è¿”å›ï¼š**æ‰€æœ‰æ•™å¸ˆç”¨æˆ·ï¼ˆåˆ†é¡µæ ¼å¼ï¼‰

### ç¤ºä¾‹ 5ï¼šç»„åˆæŸ¥è¯¢ï¼ˆæ–°åŠŸèƒ½ï¼‰

```bash
GET /users?page=1&limit=10&role=æ•™å¸ˆ&search=æ&status=ACTIVE
```

**è¿”å›ï¼š**å§“ååŒ…å«"æ"çš„æ´»è·ƒæ•™å¸ˆç”¨æˆ·

### ç¤ºä¾‹ 6ï¼šç¦ç”¨ç”¨æˆ·ï¼ˆæ–°åŠŸèƒ½ï¼‰

```bash
PATCH /users/1/disable
```

**è¿”å›ï¼š**
```json
{
  "id": 1,
  "email": "user@test.com",
  "name": "å¼ ä¸‰",
  "status": "INACTIVE",
  "message": "ç”¨æˆ·å·²ç¦ç”¨"
}
```

## ğŸ”§ æŠ€æœ¯å®ç°

### Service å±‚æ”¹åŠ¨

**`src/users/users.service.ts`**

#### æ–°å¢æ–¹æ³•ï¼š

1. **`findAllPaginated(options)`** - åˆ†é¡µæŸ¥è¯¢
```typescript
async findAllPaginated(options: {
  page: number;
  limit: number;
  role?: string;
  search?: string;
}) {
  // æ”¯æŒåˆ†é¡µã€æœç´¢ã€è§’è‰²ç­›é€‰
  // è¿”å›æ ¼å¼ä¸ admin æ¥å£ä¸€è‡´
}
```

#### å¢å¼ºæ–¹æ³•ï¼š

2. **`findOne(id)`** - è¿”å›å®Œæ•´è§’è‰²ä¿¡æ¯
3. **`update(id, data)`** - è‡ªåŠ¨åŠ å¯†å¯†ç ï¼Œè¿”å›å®Œæ•´æ•°æ®
4. **`remove(id)`** - è¿”å›åŒ…å« message çš„ç»“æœ
5. **`disable(id)`** - è¿”å›åŒ…å« message çš„ç»“æœ
6. **`enable(id)`** - è¿”å›åŒ…å« message çš„ç»“æœ

### Controller å±‚æ”¹åŠ¨

**`src/users/users.controller.ts`**

#### å¢å¼ºæ¥å£ï¼š

1. **`GET /users`** - æ”¯æŒåˆ†é¡µå’Œç­›é€‰å‚æ•°
2. **`PATCH /users/:id/disable`** - æ–°å¢ç¦ç”¨æ¥å£
3. **`PATCH /users/:id/enable`** - æ–°å¢å¯ç”¨æ¥å£

## ğŸ¨ å‘åå…¼å®¹

### ä¸å¸¦å‚æ•°ï¼ˆä¿æŒåŸæœ‰è¡Œä¸ºï¼‰

```bash
GET /users
# è¿”å›æ‰€æœ‰ç”¨æˆ·æ•°ç»„ï¼ˆæ— åˆ†é¡µï¼‰
```

### å¸¦åˆ†é¡µå‚æ•°ï¼ˆæ–°è¡Œä¸ºï¼‰

```bash
GET /users?page=1&limit=10
# è¿”å›åˆ†é¡µæ ¼å¼
```

## âš ï¸ é‡è¦è¯´æ˜

### ç ´åæ€§å˜æ›´

âŒ **æ— **ï¼æ­¤æ¬¡æ›´æ–°å®Œå…¨å‘åå…¼å®¹ã€‚

### æ¨èåšæ³•

- âœ… æ–°ä»£ç å»ºè®®ä½¿ç”¨åˆ†é¡µå‚æ•°
- âœ… æ—§ä»£ç æ— éœ€ä¿®æ”¹ï¼Œä»ç„¶å¯ç”¨
- âœ… é€æ­¥è¿ç§»åˆ°åˆ†é¡µæ ¼å¼

## ğŸ“ è¿ç§»æŒ‡å—

### ä»æ—§æ¥å£è¿ç§»

**ä¹‹å‰ï¼š**
```javascript
// è·å–æ‰€æœ‰ç”¨æˆ·
const users = await axios.get('/users');
// users æ˜¯æ•°ç»„
```

**è¿ç§»åˆ°ï¼š**
```javascript
// æ–¹å¼1: ä¿æŒä¸å˜ï¼ˆå‘åå…¼å®¹ï¼‰
const users = await axios.get('/users');
// users ä»ç„¶æ˜¯æ•°ç»„

// æ–¹å¼2: ä½¿ç”¨åˆ†é¡µï¼ˆæ¨èï¼‰
const response = await axios.get('/users', {
  params: { page: 1, limit: 10 }
});
// response.data.data æ˜¯æ•°ç»„
// response.data.pagination æ˜¯åˆ†é¡µä¿¡æ¯
```

## ğŸ”‘ ç»Ÿä¸€çš„æ¥å£è§„èŒƒ

### åˆ—è¡¨æ¥å£

**æ ¼å¼ï¼š**
```typescript
{
  data: T[],           // æ•°æ®æ•°ç»„
  pagination: {        // åˆ†é¡µä¿¡æ¯
    page: number,      // å½“å‰é¡µ
    limit: number,     // æ¯é¡µæ•°é‡
    total: number,     // æ€»è®°å½•æ•°
    totalPages: number // æ€»é¡µæ•°
  }
}
```

### æ“ä½œæ¥å£

**æ ¼å¼ï¼š**
```typescript
{
  ...entityData,  // å®ä½“æ•°æ®
  message: string // æ“ä½œç»“æœæ¶ˆæ¯
}
```

## ğŸ“Š å®Œæ•´çš„ç”¨æˆ·APIåˆ—è¡¨

| ç«¯ç‚¹                             | æ–¹æ³•   | åŠŸèƒ½         | æƒé™       | åˆ†é¡µæ”¯æŒ |
| -------------------------------- | ------ | ------------ | ---------- | -------- |
| `/users`                         | GET    | è·å–ç”¨æˆ·åˆ—è¡¨ | æ•™å¸ˆ/åŠ©æ•™  | âœ… æ”¯æŒ   |
| `/users/:id`                     | GET    | è·å–ç”¨æˆ·è¯¦æƒ… | æ•™å¸ˆ/åŠ©æ•™  | -        |
| `/users`                         | POST   | åˆ›å»ºç”¨æˆ·     | æ•™å¸ˆ       | -        |
| `/users/:id`                     | PATCH  | æ›´æ–°ç”¨æˆ·     | æ•™å¸ˆ       | -        |
| `/users/:id`                     | DELETE | åˆ é™¤ç”¨æˆ·     | æ•™å¸ˆ       | -        |
| `/users/:id/disable`             | PATCH  | ç¦ç”¨ç”¨æˆ·     | æ•™å¸ˆ       | -        |
| `/users/:id/enable`              | PATCH  | å¯ç”¨ç”¨æˆ·     | æ•™å¸ˆ       | -        |
| `/users/batch`                   | POST   | æ‰¹é‡åˆ›å»º     | æ•™å¸ˆ       | -        |
| `/users/template`                | GET    | ä¸‹è½½æ¨¡æ¿     | æ•™å¸ˆ       | -        |
|                                  |        |              |            |          |
| `/admin/users`                   | GET    | è·å–ç”¨æˆ·åˆ—è¡¨ | è¶…çº§ç®¡ç†å‘˜ | âœ… æ”¯æŒ   |
| `/admin/users/:id`               | GET    | è·å–ç”¨æˆ·è¯¦æƒ… | è¶…çº§ç®¡ç†å‘˜ | -        |
| `/admin/users`                   | POST   | åˆ›å»ºç”¨æˆ·     | è¶…çº§ç®¡ç†å‘˜ | -        |
| `/admin/users/:id`               | PATCH  | æ›´æ–°ç”¨æˆ·     | è¶…çº§ç®¡ç†å‘˜ | -        |
| `/admin/users/:id`               | DELETE | åˆ é™¤ç”¨æˆ·     | è¶…çº§ç®¡ç†å‘˜ | -        |
| `/admin/users/:id/disable`       | PATCH  | ç¦ç”¨ç”¨æˆ·     | è¶…çº§ç®¡ç†å‘˜ | -        |
| `/admin/users/:id/enable`        | PATCH  | å¯ç”¨ç”¨æˆ·     | è¶…çº§ç®¡ç†å‘˜ | -        |
| `/admin/users/batch`             | POST   | æ‰¹é‡åˆ›å»º     | è¶…çº§ç®¡ç†å‘˜ | -        |
| `/admin/users/template/download` | GET    | ä¸‹è½½æ¨¡æ¿     | è¶…çº§ç®¡ç†å‘˜ | -        |
| `/admin/users/stats/overview`    | GET    | ç»Ÿè®¡ä¿¡æ¯     | è¶…çº§ç®¡ç†å‘˜ | -        |

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### é€‰æ‹©å“ªä¸ªæ¥å£ï¼Ÿ

**ä½¿ç”¨ `/users`ï¼š**
- æ—¥å¸¸ç”¨æˆ·ç®¡ç†
- æ•™å¸ˆç®¡ç†è‡ªå·±çš„å­¦ç”Ÿ
- ä¸éœ€è¦ç³»ç»Ÿçº§æƒé™

**ä½¿ç”¨ `/admin/users`ï¼š**
- ç³»ç»Ÿç®¡ç†å‘˜æ“ä½œ
- éœ€è¦å…¨å±€ç”¨æˆ·ç®¡ç†
- éœ€è¦ç»Ÿè®¡ä¿¡æ¯

### åˆ†é¡µå‚æ•°å»ºè®®

```javascript
// æ¨èï¼šä½¿ç”¨åˆ†é¡µæé«˜æ€§èƒ½
GET /users?page=1&limit=20

// é¿å…ï¼šå¤§å‹ç³»ç»Ÿä¸ä½¿ç”¨åˆ†é¡µ
GET /users  // å¯èƒ½è¿”å›æ•°åƒæ¡è®°å½•
```

## ğŸ‰ ç»Ÿä¸€å¸¦æ¥çš„å¥½å¤„

### 1. ä¸€è‡´çš„APIä½“éªŒ

- âœ… ç»Ÿä¸€çš„è¿”å›æ ¼å¼
- âœ… ç»Ÿä¸€çš„åˆ†é¡µé€»è¾‘
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

### 2. åŠŸèƒ½å®Œæ•´æ€§

- âœ… `/users` ç°åœ¨ä¹Ÿæ”¯æŒæœç´¢å’Œç­›é€‰
- âœ… ä¸¤ä¸ªæ¥å£åŠŸèƒ½å¯¹ç­‰
- âœ… å‡å°‘æ¥å£å·®å¼‚å›°æƒ‘

### 3. å‘åå…¼å®¹

- âœ… æ—§ä»£ç æ— éœ€ä¿®æ”¹
- âœ… å¹³æ»‘è¿ç§»
- âœ… çµæ´»ä½¿ç”¨

### 4. æ€§èƒ½ä¼˜åŒ–

- âœ… åˆ†é¡µæŸ¥è¯¢å‡å°‘æ•°æ®ä¼ è¾“
- âœ… æŒ‰éœ€åŠ è½½
- âœ… æé«˜å“åº”é€Ÿåº¦

## ğŸ” æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯• 1ï¼šå‘åå…¼å®¹æ€§

```bash
# æ—§çš„è°ƒç”¨æ–¹å¼åº”è¯¥ä»ç„¶æœ‰æ•ˆ
curl -X GET "http://localhost:3000/users" \
  -H "Authorization: Bearer TOKEN"

# åº”è¿”å›ç”¨æˆ·æ•°ç»„
```

### æµ‹è¯• 2ï¼šåˆ†é¡µåŠŸèƒ½

```bash
# æ–°çš„åˆ†é¡µè°ƒç”¨
curl -X GET "http://localhost:3000/users?page=1&limit=10" \
  -H "Authorization: Bearer TOKEN"

# åº”è¿”å›åˆ†é¡µæ ¼å¼
```

### æµ‹è¯• 3ï¼šæœç´¢åŠŸèƒ½

```bash
# æœç´¢ç”¨æˆ·
curl -X GET "http://localhost:3000/users?page=1&limit=10&search=å¼ ä¸‰" \
  -H "Authorization: Bearer TOKEN"

# åº”è¿”å›åŒ¹é…çš„ç”¨æˆ·
```

### æµ‹è¯• 4ï¼šç¦ç”¨/å¯ç”¨

```bash
# ç¦ç”¨ç”¨æˆ·
curl -X PATCH "http://localhost:3000/users/1/disable" \
  -H "Authorization: Bearer TOKEN"

# å¯ç”¨ç”¨æˆ·
curl -X PATCH "http://localhost:3000/users/1/enable" \
  -H "Authorization: Bearer TOKEN"
```

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

- âœ… `src/users/users.controller.ts` - æ·»åŠ æŸ¥è¯¢å‚æ•°å’Œæ–°æ¥å£
- âœ… `src/users/users.service.ts` - æ·»åŠ åˆ†é¡µæ–¹æ³•ï¼Œå¢å¼ºç°æœ‰æ–¹æ³•

## ğŸš€ ç«‹å³ä½¿ç”¨

### é‡å¯æœåŠ¡

```bash
npm run start:dev
```

### æµ‹è¯•æ–°åŠŸèƒ½

è®¿é—® Swagger æ–‡æ¡£ï¼š
```
http://localhost:3000/api
```

åœ¨"ç”¨æˆ·ç®¡ç†"æ ‡ç­¾ä¸‹å¯ä»¥çœ‹åˆ°æ›´æ–°åçš„æ¥å£æ–‡æ¡£ã€‚

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [è§’è‰²æƒé™ç³»ç»Ÿ](./ROLE_PERMISSION_SYSTEM_README.md)
- [ç”¨æˆ·ç®¡ç†æŒ‡å—](./ADMIN_SYSTEM_README.md)
- [åå°ç®¡ç†ç³»ç»Ÿ](./ADMIN_ARTICLE_SOFT_DELETE_GUIDE.md)

---

**æ›´æ–°ç±»å‹**ï¼šåŠŸèƒ½å¢å¼º  
**å…¼å®¹æ€§**ï¼šâœ… å®Œå…¨å‘åå…¼å®¹  
**å½±å“èŒƒå›´**ï¼šç”¨æˆ·æ¨¡å—æ¥å£  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆå¹¶æµ‹è¯•
