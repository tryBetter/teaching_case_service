# API æ¥å£åˆå¹¶è®¡åˆ’

## ğŸ¯ ç›®æ ‡

å°†åå°ç®¡ç†æ¥å£ï¼ˆ`/admin/*`ï¼‰ä¸æ™®é€šæ¥å£åˆå¹¶ï¼Œå®ç°ä¸€å¥—æ¥å£é€‚é…æ‰€æœ‰è§’è‰²ï¼Œé€šè¿‡æƒé™æ§åˆ¶åŒºåˆ†åŠŸèƒ½ã€‚

## ğŸ“Š æ¨¡å—åˆ†æ

### ç°æœ‰æ¨¡å—å¯¹æ¯”

| æ™®é€šæ¥å£             | åå°ç®¡ç†æ¥å£               | æ˜¯å¦éœ€è¦åˆå¹¶ |
| -------------------- | -------------------------- | ------------ |
| `/users`             | `/admin/users`             | âœ… æ˜¯         |
| `/articles`          | `/admin/articles`          | âœ… æ˜¯         |
| `/media`             | `/admin/media`             | âœ… æ˜¯         |
| `/categories`        | `/admin/categories`        | âœ… æ˜¯         |
| `/comment`           | `/admin/comments`          | âœ… æ˜¯         |
| `/favorite`          | `/admin/favorites`         | âœ… æ˜¯         |
| `/note`              | `/admin/notes`             | âœ… æ˜¯         |
| `/hot-search`        | `/admin/hot-search`        | âœ… æ˜¯         |
| `/filter-conditions` | `/admin/filter-conditions` | âœ… æ˜¯         |
| -                    | `/admin/roles`             | âŒ ç®¡ç†å‘˜ä¸“å± |
| -                    | `/admin/stats`             | âŒ ç®¡ç†å‘˜ä¸“å± |
| -                    | `/admin/auth`              | âŒ ç®¡ç†å‘˜ä¸“å± |

## ğŸ”„ åˆå¹¶ç­–ç•¥

### åŸºæœ¬åŸåˆ™

1. **ä¿ç•™æ™®é€šæ¥å£è·¯å¾„**ï¼š`/users`ã€`/articles` ç­‰
2. **ç§»é™¤ `/admin` å‰ç¼€**ï¼šé¿å…è·¯å¾„é‡å¤
3. **ä½¿ç”¨æƒé™è£…é¥°å™¨**ï¼šé€šè¿‡ `@RequirePermissions` æˆ– `@RequireSuperAdmin` æ§åˆ¶è®¿é—®
4. **å‘åå…¼å®¹**ï¼šç¡®ä¿ç°æœ‰å®¢æˆ·ç«¯ä¸å—å½±å“

### æƒé™åˆ†çº§

```typescript
// æ™®é€šç”¨æˆ·ï¼šæŸ¥çœ‹è‡ªå·±çš„æ•°æ®
@Public() æˆ– @RequirePermissions([Permission.XXX_READ])

// æ•™å¸ˆ/ç»„é•¿ï¼šç®¡ç†è‡ªå·±çš„èµ„æº
@RequireTeacher() æˆ– @RequirePermissions([Permission.XXX_MANAGE])

// è¶…çº§ç®¡ç†å‘˜ï¼šç®¡ç†æ‰€æœ‰èµ„æº
@RequireSuperAdmin()
```

## ğŸ“‹ è¯¦ç»†åˆå¹¶è®¡åˆ’

### 1. ç”¨æˆ·ç®¡ç† `/users`

#### ç°æœ‰æ¥å£

**æ™®é€šæ¥å£ (`/users`)**ï¼š
- âœ… `GET /users` - è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€æœç´¢ï¼‰
- âœ… `GET /users/:id` - è·å–ç”¨æˆ·è¯¦æƒ…
- âœ… `POST /users` - åˆ›å»ºç”¨æˆ·
- âœ… `PATCH /users/:id` - æ›´æ–°ç”¨æˆ·
- âœ… `DELETE /users/:id` - åˆ é™¤ç”¨æˆ·
- âœ… `PATCH /users/:id/disable` - ç¦ç”¨ç”¨æˆ·
- âœ… `PATCH /users/:id/enable` - å¯ç”¨ç”¨æˆ·
- âœ… `POST /users/batch` - æ‰¹é‡åˆ›å»º
- âœ… `GET /users/template/download` - ä¸‹è½½æ¨¡æ¿

**åå°æ¥å£ (`/admin/users`)**ï¼š
- âœ… `GET /admin/users` - è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€æœç´¢ï¼‰
- âœ… `GET /admin/users/roles` - è·å–è§’è‰²é€‰é¡¹ â­ æ–°å¢
- âœ… `GET /admin/users/:id` - è·å–ç”¨æˆ·è¯¦æƒ…
- âœ… `POST /admin/users` - åˆ›å»ºç”¨æˆ·
- âœ… `PATCH /admin/users/:id` - æ›´æ–°ç”¨æˆ·
- âœ… `DELETE /admin/users/:id` - åˆ é™¤ç”¨æˆ·
- âœ… `PATCH /admin/users/:id/disable` - ç¦ç”¨ç”¨æˆ·
- âœ… `PATCH /admin/users/:id/enable` - å¯ç”¨ç”¨æˆ·
- âœ… `POST /admin/users/batch` - æ‰¹é‡åˆ›å»º
- âœ… `GET /admin/users/template/download` - ä¸‹è½½æ¨¡æ¿
- âœ… `GET /admin/users/stats/overview` - ç»Ÿè®¡æ¦‚è§ˆ â­ æ–°å¢

#### åˆå¹¶æ–¹æ¡ˆ

**ç»“è®º**ï¼šä¸¤ä¸ªæ¥å£**å·²åŸºæœ¬ç»Ÿä¸€**ï¼

**éœ€è¦åšçš„**ï¼š
1. å°† `/admin/users/roles` è¿ç§»åˆ° `/users/roles`
2. å°† `/admin/users/stats/overview` è¿ç§»åˆ° `/users/stats`
3. ä¿ç•™ `/admin/users` ä½œä¸ºåˆ«åï¼ˆå¯é€‰ï¼‰

### 2. æ–‡ç« ç®¡ç† `/articles`

#### ç°æœ‰æ¥å£

**æ™®é€šæ¥å£ (`/articles`)**ï¼š
- âœ… `GET /articles` - è·å–æ–‡ç« åˆ—è¡¨ï¼ˆå·²å‘å¸ƒï¼‰
- âœ… `GET /articles/:id` - è·å–æ–‡ç« è¯¦æƒ…
- âœ… `POST /articles` - åˆ›å»ºæ–‡ç« 
- âœ… `PATCH /articles/:id` - æ›´æ–°æ–‡ç« 
- âœ… `DELETE /articles/:id` - åˆ é™¤æ–‡ç« ï¼ˆè½¯åˆ é™¤ï¼‰
- âš ï¸ ç¼ºå°‘æ¢å¤ã€æ°¸ä¹…åˆ é™¤åŠŸèƒ½
- âš ï¸ ç¼ºå°‘ç®¡ç†å‘˜æŸ¥çœ‹æ‰€æœ‰æ–‡ç« åŠŸèƒ½

**åå°æ¥å£ (`/admin/articles`)**ï¼š
- âœ… `GET /admin/articles` - è·å–æ‰€æœ‰æ–‡ç« ï¼ˆå«åˆ é™¤ï¼‰
- âœ… `GET /admin/articles/deleted/list` - è·å–å·²åˆ é™¤æ–‡ç« 
- âœ… `GET /admin/articles/:id` - è·å–æ–‡ç« è¯¦æƒ…
- âœ… `POST /admin/articles` - åˆ›å»ºæ–‡ç« 
- âœ… `PATCH /admin/articles/:id` - æ›´æ–°æ–‡ç« 
- âœ… `DELETE /admin/articles/:id` - è½¯åˆ é™¤
- âœ… `POST /admin/articles/:id/restore` - æ¢å¤æ–‡ç« 
- âœ… `DELETE /admin/articles/:id/permanent` - æ°¸ä¹…åˆ é™¤
- âœ… `POST /admin/articles/:id/publish` - å‘å¸ƒ
- âœ… `POST /admin/articles/:id/unpublish` - å–æ¶ˆå‘å¸ƒ
- âœ… `POST /admin/articles/:id/feature` - è®¾ä¸ºç²¾é€‰
- âœ… `POST /admin/articles/:id/unfeature` - å–æ¶ˆç²¾é€‰
- âœ… `GET /admin/articles/stats/overview` - ç»Ÿè®¡æ¦‚è§ˆ

#### åˆå¹¶æ–¹æ¡ˆ

**éœ€è¦åšçš„**ï¼š
1. åœ¨ `/articles` ä¸­æ·»åŠ  `includeDeleted` æŸ¥è¯¢å‚æ•°ï¼ˆç®¡ç†å‘˜å¯è§ï¼‰
2. æ·»åŠ æ¢å¤ã€æ°¸ä¹…åˆ é™¤ã€å‘å¸ƒæ§åˆ¶æ¥å£
3. æ·»åŠ ç»Ÿè®¡æ¥å£

### 3. åª’ä½“ç®¡ç† `/media`

#### ç°æœ‰æ¥å£

**æ™®é€šæ¥å£ (`/media`)**ï¼š
- âœ… `POST /media` - åˆ›å»ºåª’ä½“è®°å½•
- âœ… `POST /media/upload` - ä¸Šä¼ æ–‡ä»¶
- âœ… `GET /media` - è·å–åª’ä½“åˆ—è¡¨ï¼ˆæŒ‰ç”¨æˆ·è¿‡æ»¤ï¼‰
- âœ… `GET /media/:id` - è·å–åª’ä½“è¯¦æƒ…
- âœ… `DELETE /media/:id` - åˆ é™¤åª’ä½“

**åå°æ¥å£ (`/admin/media`)**ï¼š
- âœ… `GET /admin/media` - è·å–æ‰€æœ‰åª’ä½“ï¼ˆæ”¯æŒé«˜çº§æœç´¢ï¼‰
- âœ… `GET /admin/media/:id` - è·å–åª’ä½“è¯¦æƒ… â­ å·²æ·»åŠ 
- âœ… `DELETE /admin/media/:id` - åˆ é™¤åª’ä½“
- âœ… `DELETE /admin/media/batch` - æ‰¹é‡åˆ é™¤
- âœ… `GET /admin/media/stats/overview` - ç»Ÿè®¡æ¦‚è§ˆ
- âœ… `GET /admin/media/stats/distribution` - ç±»å‹åˆ†å¸ƒ
- âœ… `GET /admin/media/recent` - æœ€è¿‘ä¸Šä¼ 

#### åˆå¹¶æ–¹æ¡ˆ

**éœ€è¦åšçš„**ï¼š
1. åœ¨ `/media` ä¸­æ·»åŠ é«˜çº§æœç´¢åŠŸèƒ½ï¼ˆç®¡ç†å‘˜å¯ç”¨ï¼‰
2. æ·»åŠ æ‰¹é‡åˆ é™¤æ¥å£
3. æ·»åŠ ç»Ÿè®¡æ¥å£

## ğŸš€ å®æ–½æ­¥éª¤

### é˜¶æ®µ1ï¼šç”¨æˆ·ç®¡ç†åˆå¹¶ âœ…

**çŠ¶æ€**ï¼šå·²åŸºæœ¬å®Œæˆ

**å¾…å®Œæˆ**ï¼š
- [ ] è¿ç§» `/admin/users/roles` â†’ `/users/roles`
- [ ] è¿ç§» `/admin/users/stats/overview` â†’ `/users/stats`

### é˜¶æ®µ2ï¼šæ–‡ç« ç®¡ç†åˆå¹¶

**æ ¸å¿ƒä»»åŠ¡**ï¼š
1. æ·»åŠ  `GET /articles?includeDeleted=true` ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰
2. æ·»åŠ  `POST /articles/:id/restore`
3. æ·»åŠ  `DELETE /articles/:id/permanent`
4. æ·»åŠ å‘å¸ƒæ§åˆ¶æ¥å£
5. æ·»åŠ ç»Ÿè®¡æ¥å£

### é˜¶æ®µ3ï¼šåª’ä½“ç®¡ç†åˆå¹¶

**æ ¸å¿ƒä»»åŠ¡**ï¼š
1. å¢å¼º `GET /media` æ”¯æŒé«˜çº§æœç´¢
2. æ·»åŠ  `DELETE /media/batch`
3. æ·»åŠ ç»Ÿè®¡æ¥å£

### é˜¶æ®µ4ï¼šå…¶ä»–æ¨¡å—åˆå¹¶

- åˆ†ç±»ç®¡ç†
- è¯„è®ºç®¡ç†
- æ”¶è—ç®¡ç†
- ç¬”è®°ç®¡ç†
- çƒ­æœç®¡ç†
- ç­›é€‰æ¡ä»¶ç®¡ç†

### é˜¶æ®µ5ï¼šæ¸…ç†ä¸æµ‹è¯•

1. æ›´æ–°å‰ç«¯è°ƒç”¨
2. å…¼å®¹æ€§æµ‹è¯•
3. æ–‡æ¡£æ›´æ–°
4. å¯é€‰ï¼šä¿ç•™ `/admin/*` ä½œä¸ºåˆ«å

## ğŸ”‘ æŠ€æœ¯å®ç°

### æƒé™è£…é¥°å™¨ç»„åˆ

```typescript
// æ™®é€šç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„æ•°æ®
@Get()
findAll(@Query() query, @CurrentUser() user) {
  // éç®¡ç†å‘˜åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ•°æ®
  if (!isSuperAdmin(user)) {
    query.userId = user.id;
  }
  return this.service.findAll(query);
}

// ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®
@Get('all')
@RequireSuperAdmin()
findAllForAdmin(@Query() query) {
  return this.service.findAll(query);
}
```

### Service å±‚å¤ç”¨

```typescript
// Service å±‚ç»Ÿä¸€å¤„ç†
async findAll(options: {
  userId?: number;
  includeDeleted?: boolean;
  ...
}) {
  const where = {};
  
  // å¦‚æœæŒ‡å®šç”¨æˆ·ï¼ŒåªæŸ¥è¯¥ç”¨æˆ·çš„æ•°æ®
  if (options.userId) {
    where.authorId = options.userId;
  }
  
  // ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å·²åˆ é™¤çš„
  if (!options.includeDeleted) {
    where.deletedAt = null;
  }
  
  return this.prisma.xxx.findMany({ where });
}
```

## âš ï¸ é£é™©ä¸è€ƒè™‘

### 1. å‘åå…¼å®¹

**é—®é¢˜**ï¼šç°æœ‰å®¢æˆ·ç«¯å¯èƒ½ä½¿ç”¨ `/admin/*` è·¯å¾„

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ–¹æ¡ˆAï¼šä¿ç•™ `/admin/*` ä½œä¸ºåˆ«åï¼ˆé‡å®šå‘æˆ–åŒè·¯ç”±ï¼‰
- æ–¹æ¡ˆBï¼šä½¿ç”¨ API ç‰ˆæœ¬æ§åˆ¶
- **æ¨è**ï¼šæ–¹æ¡ˆAï¼Œä¿æŒå…¼å®¹

### 2. æƒé™ç²’åº¦

**é—®é¢˜**ï¼šä¸åŒè§’è‰²éœ€è¦ä¸åŒçš„æ•°æ®è®¿é—®èŒƒå›´

**è§£å†³æ–¹æ¡ˆ**ï¼š
- Service å±‚æ ¹æ®ç”¨æˆ·è§’è‰²åŠ¨æ€è°ƒæ•´æŸ¥è¯¢æ¡ä»¶
- Controller å±‚ä½¿ç”¨æƒé™è£…é¥°å™¨æ§åˆ¶ç«¯ç‚¹è®¿é—®

### 3. å‰ç«¯è°ƒæ•´

**é—®é¢˜**ï¼šåå°ç®¡ç†ç•Œé¢ä½¿ç”¨ `/admin/*` è·¯å¾„

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¿ç•™ `/admin/*` è·¯å¾„ï¼Œæˆ–
- æ›´æ–°å‰ç«¯ JavaScript ä¸­çš„ API è·¯å¾„

### 4. æµ‹è¯•è¦†ç›–

**å¿…é¡»æµ‹è¯•**ï¼š
- å„è§’è‰²çš„æƒé™æ­£ç¡®æ€§
- æ•°æ®éš”ç¦»æ­£ç¡®æ€§
- å‘åå…¼å®¹æ€§

## ğŸ“Š é¢„æœŸæ”¶ç›Š

### ä»£ç ç»´æŠ¤

- âœ… å‡å°‘é‡å¤ä»£ç 
- âœ… ç»Ÿä¸€ä¸šåŠ¡é€»è¾‘
- âœ… æ›´å®¹æ˜“ç»´æŠ¤

### API è®¾è®¡

- âœ… RESTful è§„èŒƒ
- âœ… è·¯å¾„æ›´æ¸…æ™°
- âœ… æ›´æ˜“ç†è§£

### å¼€å‘ä½“éªŒ

- âœ… åªéœ€ç»´æŠ¤ä¸€å¥—æ¥å£
- âœ… æƒé™é€»è¾‘é›†ä¸­
- âœ… æ›´å®¹æ˜“æ‰©å±•

## ğŸ¬ æ‰§è¡Œå»ºè®®

### ä¼˜å…ˆçº§

1. **P0 - ç”¨æˆ·ç®¡ç†**ï¼šå·²åŸºæœ¬å®Œæˆï¼Œåªéœ€å°è°ƒæ•´
2. **P1 - æ–‡ç« ç®¡ç†**ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼Œä½¿ç”¨é¢‘ç¹
3. **P1 - åª’ä½“ç®¡ç†**ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼Œä½¿ç”¨é¢‘ç¹
4. **P2 - å…¶ä»–æ¨¡å—**ï¼šæŒ‰éœ€åˆå¹¶

### å®æ–½æ–¹å¼

**å»ºè®®**ï¼šé€ä¸ªæ¨¡å—æ¸è¿›å¼åˆå¹¶

1. ä¿ç•™åŸæ¥å£
2. å¢å¼ºæ™®é€šæ¥å£åŠŸèƒ½
3. æµ‹è¯•éªŒè¯
4. ï¼ˆå¯é€‰ï¼‰åºŸå¼ƒ admin æ¥å£

**ä¸å»ºè®®**ï¼šä¸€æ¬¡æ€§å…¨éƒ¨é‡æ„

## ğŸ“ å¾…åŠæ¸…å•

- [x] åˆ†ææ¨¡å—å·®å¼‚
- [ ] ç”¨æˆ·ç®¡ç†ï¼šè¿ç§»è§’è‰²å’Œç»Ÿè®¡æ¥å£
- [ ] æ–‡ç« ç®¡ç†ï¼šæ·»åŠ ç®¡ç†å‘˜åŠŸèƒ½
- [ ] åª’ä½“ç®¡ç†ï¼šæ·»åŠ é«˜çº§æœç´¢å’Œç»Ÿè®¡
- [ ] åˆ†ç±»ç®¡ç†ï¼šåˆå¹¶æ¥å£
- [ ] è¯„è®ºç®¡ç†ï¼šåˆå¹¶æ¥å£
- [ ] å…¶ä»–æ¨¡å—ï¼šæŒ‰éœ€åˆå¹¶
- [ ] å‰ç«¯é€‚é…
- [ ] æµ‹è¯•éªŒè¯
- [ ] æ–‡æ¡£æ›´æ–°

---

**åˆ›å»ºæ—¥æœŸ**ï¼š2025å¹´10æœˆ10æ—¥  
**çŠ¶æ€**ï¼šè§„åˆ’ä¸­  
**æ‰§è¡Œæ–¹å¼**ï¼šæ¸è¿›å¼é€æ¨¡å—åˆå¹¶

