# 媒体查看功能使用指南

## ✅ 功能已完成

后台管理系统的媒体查看功能已完整实现！

## 🚀 使用方法

### 访问媒体管理

1. 启动服务：`npm run start:dev`
2. 访问：`http://localhost:3000/admin/`
3. 登录后点击侧边栏"媒体管理"

### 查看媒体详情

1. 在媒体列表中找到要查看的媒体
2. 点击 **👁️ 查看**按钮
3. 在弹出窗口中查看媒体详情和预览

## 📝 显示内容

### 1. 媒体预览

#### 图片类型
- 显示图片预览
- 最大高度 400px
- 支持缩放查看
- 加载失败显示提示

#### 视频类型
- 显示视频播放器
- 支持播放控制
- 音量调节
- 进度条

### 2. 媒体信息

**基本信息：**
- ID
- 文件名
- 类型（IMAGE/VIDEO）
- 文件大小（KB 和 bytes）

**详细信息：**
- 创建时间
- URL（可点击访问）
- 关联文章列表

### 3. 操作按钮

- **关闭**：关闭查看窗口
- **下载文件**：直接下载媒体文件

## 🎨 界面预览

### 查看图片

```
┌────────────────────────────────────────────┐
│ 查看媒体文件 - example.jpg            [X] │
├────────────────────────────────────────────┤
│                                            │
│           [图片预览显示区域]               │
│                                            │
├────────────────────────────────────────────┤
│ ID: 1              │ 创建时间: 2025-10-08  │
│ 文件名: example.jpg│ URL: /uploads/...     │
│ 类型: IMAGE        │ 关联文章: [文章1]     │
│ 大小: 234.56 KB    │                       │
├────────────────────────────────────────────┤
│                   [关闭] [下载文件]         │
└────────────────────────────────────────────┘
```

### 查看视频

```
┌────────────────────────────────────────────┐
│ 查看媒体文件 - demo.mp4               [X] │
├────────────────────────────────────────────┤
│                                            │
│           [视频播放器]                     │
│           [▶️ 播放控制]                    │
│                                            │
├────────────────────────────────────────────┤
│ ID: 2              │ 创建时间: 2025-10-08  │
│ 文件名: demo.mp4   │ URL: /uploads/...     │
│ 类型: VIDEO        │ 关联文章: [文章1][文章2]│
│ 大小: 5.12 MB      │                       │
├────────────────────────────────────────────┤
│                   [关闭] [下载文件]         │
└────────────────────────────────────────────┘
```

## 💡 功能特性

### 1. 智能预览
- ✅ 图片自动预览
- ✅ 视频可播放
- ✅ 加载失败提示
- ✅ 响应式大小

### 2. 详细信息
- ✅ 完整的文件信息
- ✅ 格式化的文件大小
- ✅ 可点击的URL链接
- ✅ 关联文章列表

### 3. 文件操作
- ✅ 在线预览
- ✅ 直接下载
- ✅ 新标签打开

## 📋 操作示例

### 示例 1：查看图片

```
1. 在媒体列表中找到图片文件
2. 点击"👁️ 查看"按钮
3. 看到图片预览
4. 查看文件详细信息
5. 可以点击"下载文件"保存到本地
```

### 示例 2：查看视频

```
1. 在媒体列表中找到视频文件
2. 点击"👁️ 查看"按钮
3. 看到视频播放器
4. 点击播放按钮观看视频
5. 查看文件详细信息
```

### 示例 3：查看关联文章

```
1. 点击"查看"按钮
2. 在详情中看到"关联文章"
3. 显示所有使用该媒体的文章列表
4. 以标签形式展示
```

## 🔑 文件大小格式

自动转换为易读格式：

```
1024 bytes     → 1.00 KB
1048576 bytes  → 1024.00 KB (1 MB)
5242880 bytes  → 5120.00 KB (5 MB)
```

## ⚠️ 注意事项

1. **预览限制**：只支持图片和视频预览
2. **文件大小**：大文件可能加载较慢
3. **浏览器支持**：视频格式需要浏览器支持
4. **网络连接**：预览需要稳定的网络连接
5. **CORS 设置**：确保媒体URL允许跨域访问

## 🔧 技术实现

### 新增内容

**HTML (index.html)**
- 查看媒体模态框
- 预览区域
- 详细信息表格
- 下载按钮

**JavaScript (admin.js)**
- `viewMedia(mediaId)` 函数
- 图片预览渲染
- 视频播放器渲染
- 文件信息格式化

### 数据流程

```
点击查看按钮
    ↓
获取媒体列表 (GET /admin/media)
    ↓
查找对应媒体数据
    ↓
填充媒体信息
    ↓
根据类型渲染预览
    - IMAGE: 图片预览
    - VIDEO: 视频播放器
    - 其他: 提示无法预览
    ↓
显示查看模态框
```

### 预览实现

**图片预览：**
```javascript
<img 
  src="${media.url}" 
  style="max-width: 100%; max-height: 400px;"
  onerror="显示加载失败提示"
/>
```

**视频预览：**
```javascript
<video controls style="max-width: 100%; max-height: 400px;">
  <source src="${media.url}" type="video/mp4">
</video>
```

## 📊 完整功能清单

媒体管理模块现在支持：

| 功能   | 状态     | 说明           |
| ------ | -------- | -------------- |
| 👁️ 查看 | ✅ 已实现 | 预览和查看详情 |
| 📥 下载 | ✅ 已实现 | 直接下载文件   |
| 🗑️ 删除 | ✅ 已有   | 删除媒体文件   |
| 📋 列表 | ✅ 已有   | 查看所有媒体   |
| 📊 统计 | ✅ 已有   | 媒体统计信息   |

## 🎯 使用场景

### 场景 1：确认图片内容

```
1. 需要确认某张图片的内容
2. 点击"查看"按钮
3. 在预览区域查看图片
4. 确认无误后关闭
```

### 场景 2：检查视频质量

```
1. 点击视频的"查看"按钮
2. 播放视频检查质量
3. 查看文件大小和时长
4. 决定是否保留
```

### 场景 3：查找媒体使用情况

```
1. 点击"查看"按钮
2. 在"关联文章"查看哪些文章使用了该媒体
3. 判断是否可以安全删除
```

### 场景 4：下载备份

```
1. 点击"查看"按钮
2. 点击"下载文件"按钮
3. 保存到本地作为备份
```

## 🐛 问题排查

### 问题1：图片无法预览

**原因**：
- 图片URL无效
- 网络问题
- CORS限制

**解决**：
- 检查URL是否正确
- 检查网络连接
- 配置CORS允许

### 问题2：视频无法播放

**原因**：
- 视频格式不支持
- 文件太大
- 编码格式问题

**解决**：
- 检查浏览器对视频格式的支持
- 等待加载完成
- 尝试其他浏览器

### 问题3：关联文章为空

**说明**：该媒体文件未被任何文章使用

**操作**：可以安全删除该媒体

## 🎨 增强建议

### 未来可以添加的功能：

1. **编辑功能**
   - 修改文件名
   - 更新文件URL
   - 重新上传

2. **批量操作**
   - 批量查看
   - 批量下载
   - 批量删除

3. **更多预览**
   - PDF预览
   - 音频播放
   - 文档预览

4. **图片编辑**
   - 裁剪
   - 旋转
   - 滤镜

## 📞 相关功能

- [文章管理功能](./ADMIN_ARTICLE_SOFT_DELETE_GUIDE.md)
- [文章编辑功能](./ARTICLE_EDIT_FEATURE_GUIDE.md)
- [媒体管理API](./ADMIN_MEDIA_MANAGEMENT_API.md)

---

**实现日期**：2025年10月8日  
**版本**：v1.0  
**状态**：✅ 已完成
